{% extends "base.html" %}

{% block title %}Change Your TamerMap Password - Update Account Security{% endblock %}

{% block meta_description %}Update your TamerMap password to keep your Pokemon card hunting account secure. Change your password with our secure password update tool.{% endblock %}
{% block content %}
<div class="page-content">
  <h1 class="center">Change Your Password</h1>
  <div class="form-container">
    {% if change_password_form.errors %}
      <div class="error-messages">
        <ul>
          {% for field, errors in change_password_form.errors.items() %}
            {% for error in errors %}
              <li>{{ error }}</li>
            {% endfor %}
          {% endfor %}
        </ul>
      </div>
    {% endif %}
    <form action="{{ url_for('custom_change_password') }}" method="POST">
      {{ change_password_form.hidden_tag() }}
      <div>
        <label for="current-password">{{ change_password_form.current_password.label.text }}</label>
        {{ change_password_form.current_password(placeholder="Enter your current password", id="current-password") }}
      </div>
      <div>
        <label for="new-password">{{ change_password_form.new_password.label.text }}</label>
        {{ change_password_form.new_password(placeholder="Enter your new password", id="new-password", pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{8,}", title="Min 8 chars, include upper/lower and a number") }}
        <div id="new-password-strength-meter"></div>
      </div>
      <div>
        <label for="new-password-confirm">{{ change_password_form.new_password_confirm.label.text }}</label>
        {{ change_password_form.new_password_confirm(placeholder="Confirm your new password", id="new-password-confirm") }}
      </div>
      <button type="submit">Change Password</button>
      <div style="margin-top:12px">
                           <small class="text-muted">Forgot your current password? <a href="{{ url_for('security.forgot_password') }}">Reset via email</a></small>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const newPasswordInput = document.getElementById('new-password');
    if (newPasswordInput) {
        new PasswordStrengthMeter(newPasswordInput, {
            minLength: 8,
            requireUppercase: true,
            requireLowercase: true,
            requireNumbers: true,
            requireSpecialChars: false
        });
    }
});
</script>
{% endblock %}
