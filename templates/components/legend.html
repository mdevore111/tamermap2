<!-- Updated Legend: Integrated header with toggle button -->
<div id="legend">
  <div id="legend-header">
    <h3 style="margin: 0;">Legend</h3>
    <div class="legend-header-controls">
      <div class="toggle-button-container" id="reset-button-container">
        <button id="legend-reset" aria-label="Reset Filters" data-bs-toggle="tooltip" data-bs-placement="top" title="Reset Filters">
          <i class="fas fa-redo-alt"></i>
        </button>
      </div>
      <div class="toggle-button-container">
        <button id="legend-toggle" aria-label="Toggle Legend" data-bs-toggle="tooltip" data-bs-placement="top">
          <i class="fas fa-chevron-up"></i>
        </button>
      </div>
    </div>
  </div>
  <div id="legend-body">
    <!-- Legend Search: Wrap the input in a container for clear icon -->
    <div id="legend-search-container" class="position-relative">
      <input type="text" id="legend_filter" placeholder="Search..." data-bs-toggle="tooltip" data-bs-placement="right" title="Filter locations by name, address, phone, or type.">
      <span id="clear-legend" class="clear-icon">âœ•</span>
    </div>

    <label data-bs-toggle="tooltip" data-bs-placement="right" title="Toggle display of kiosk locations.">
      <input type="checkbox" id="filter-kiosk" checked> ğŸ¤– Kiosks
    </label><br>
    
    <!-- Route Planning Section -->
    <div id="route-planning-section">
      <button class="route-planning-btn{% if not is_pro %} pro-only{% endif %}" id="plan-route-btn" 
              onclick="{% if is_pro %}openRoutePanel(){% else %}showProUpgradeModal(){% endif %}" 
              data-bs-toggle="tooltip" 
              data-bs-placement="right" 
              title="{% if is_pro %}Plan a route to multiple locations{% else %}Upgrade to Pro to access route planning{% endif %}">
        <i class="fas fa-route"></i>
        <span>Route Planning</span>
        <span class="pro-badge">Pro</span>
      </button>
    </div>
    
    <label data-bs-toggle="tooltip" data-bs-placement="right" title="Toggle display of retail store locations.">
      <input type="checkbox" id="filter-retail"
             {% if is_pro %}
               checked
             {% else %}
               class="pro-only"
             {% endif %}>
       ğŸ¬ Retail Stores
    </label><br>
    <label data-bs-toggle="tooltip" data-bs-placement="right" title="Toggle display of independent store locations.">
      <input type="checkbox" id="filter-indie"
             {% if is_pro %}
               checked
             {% else %}
               class="pro-only"
             {% endif %}>
       ğŸ¤“ Indie Stores
    </label>
    <br>
    <label data-bs-toggle="tooltip" data-bs-placement="right" title="Only show locations that are currently open.">
      <input type="checkbox" id="filter-open-now"
             {% if not is_pro %}
               class="pro-only"
             {% endif %}>
       â° Open Now
    </label>
    <br>
    <label data-bs-toggle="tooltip" data-bs-placement="right" title="Only show new kiosks or stores.">
      <input type="checkbox" id="filter-new"
             {% if not is_pro %}
               class="pro-only"
             {% endif %}>
       ğŸŒŸ New Locations
    </label>
    <br>
    <label data-bs-toggle="tooltip" data-bs-placement="right" title="Show a heat map of popular locations.">
      <input type="checkbox" id="filter-popular-areas"
             {% if not is_pro %}
               class="pro-only"
             {% endif %}>
      ğŸ”¥ Popular Areas
    </label>
    <br>
    <label data-bs-toggle="tooltip" data-bs-placement="right" title="Toggle upcoming events">
    <input type="checkbox" id="filter-events"
           {% if not is_pro %}
            class="pro-only"
           {% endif %}>
       ğŸ“… Events
    </label>
    
    <!-- Events Day Range Slider - only visible when events checkbox is checked -->
    <div id="event-days-slider-container" style="display: none; margin: 5px 0 8px 20px;">
      <div style="display: flex; justify-content: space-between; margin-bottom: 2px; font-size: 12px; padding-right: 10px;">
        <span>1 day</span>
        <span id="event-days-value">30 days</span>
        <span>60 days</span>
      </div>
      <input type="range" id="event-days-slider" 
             min="1" max="60" value="30" step="1" 
             class="form-range{% if not is_pro %} pro-only{% endif %}" 
             style="width: 95%;"
             data-bs-toggle="tooltip" 
             data-bs-placement="right" 
             title="Filter events by days in the future">
    </div>
  </div>
</div> 