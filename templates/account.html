{% extends "base.html" %}

{% block title %}My Account - Manage Profile, Membership & Settings | TamerMap{% endblock %}

{% block meta_description %}Manage your TamerMap account settings, profile information, membership status, and Pokemon card hunting preferences. Update your personal details and subscription settings.{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/account.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Schema.org markup for account management page -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "My Account - TamerMap",
    "description": "Manage your TamerMap account settings, profile information, and membership status",
    "url": "{{ request.url }}",
    "mainEntity": {
      "@type": "Person",
      "name": "{{ current_user.first_name }} {{ current_user.last_name }}",
      "email": "{{ current_user.email }}",
      "memberOf": {
        "@type": "Organization",
        "name": "TamerMap",
        "description": "Pokemon card hunting platform"
      }
    },
    "breadcrumb": {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "{{ request.url_root.rstrip('/') }}"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "My Account",
          "item": "{{ request.url }}"
        }
      ]
    }
  }
  </script>
{% endblock %}

{% block content %}
<div class="form-container">
    <h1 class="tds-text--h1">Personal Information</h1>
    <p class="subtitle">
        Manage your basic information, contact methods, account details, and membership status.
    </p>
    <form method="post" action="{{ url_for('auth.update_profile') }}">
        {{ form.hidden_tag() if form is defined else "" }}

        <div class="profile-container">
            <!-- Basic Information Section -->
            <section class="profile-section" id="basic-info-section">
                <div class="section-header">
                    <h2 class="tds-text--h2">NAME</h2>
                    <a href="#" class="edit-link" data-section="basic-info-section">Edit</a>
                </div>
                <p class="tds-text--value" id="display-name">
                    {{ current_user.first_name }} {{ current_user.last_name }}
                </p>
                <div class="edit-field" id="edit-name" style="display:none;">
                    <input type="text" name="first_name" placeholder="First Name" value="{{ current_user.first_name }}"
                           class="form-control" style="display:inline-block; width:48%; margin-right:4%;">
                    <input type="text" name="last_name" placeholder="Last Name" value="{{ current_user.last_name }}"
                           class="form-control" style="display:inline-block; width:48%;">
                </div>
            </section>

            <!-- Primary Email Section -->
            <section class="profile-section" id="email-section">
                <div class="section-header">
                    <h2 class="tds-text--h2">PRIMARY EMAIL</h2>
                    <a href="#" class="edit-link" data-section="email-section">Edit</a>
                </div>
                <p class="tds-text--value" id="display-email">
                    <i class="fa fa-envelope" style="color: #007bff; margin-right: 5px;"></i>
                    {{ current_user.email }}
                </p>
                <div class="edit-field" id="edit-email" style="display:none;">
                    <input type="email" name="email" placeholder="Primary Email" value="{{ current_user.email }}" class="form-control">
                </div>
            </section>

<!--            &lt;!&ndash; Primary Phone Number Section (Pro Subscribers Only) &ndash;&gt;-->
<!--            <section class="profile-section" id="phone-section">-->
<!--                <div class="section-header">-->
<!--                    <h2 class="tds-text&#45;&#45;h2">PRIMARY PHONE NUMBER</h2>-->
<!--                    <a href="#" class="edit-link" data-section="phone-section">Edit</a>-->
<!--                </div>-->
<!--                <p class="tds-text&#45;&#45;value" id="display-phone">-->
<!--                    <i class="fa fa-phone" style="color: green; margin-right: 5px;"></i>-->
<!--                    {{ current_user.phone if current_user.phone is defined else "+1 000 000 0000" }}-->
<!--                </p>-->
<!--                <div class="edit-field" id="edit-phone" style="display:none;">-->
<!--                    <input type="text" name="phone" placeholder="Primary Phone Number" value="{{ current_user.phone if current_user.phone is defined else '' }}" class="form-control">-->
<!--                </div>-->
<!--            </section>-->

<!--            &lt;!&ndash; Billing Address Section (Pro Subscribers Only) &ndash;&gt;-->
<!--            <section class="profile-section" id="address-section">-->
<!--                <div class="section-header">-->
<!--                    <h2 class="tds-text&#45;&#45;h2">BILLING ADDRESS</h2>-->
<!--                    <a href="#" class="edit-link" data-section="address-section">Edit</a>-->
<!--                </div>-->
<!--                <p class="tds-text&#45;&#45;value" id="display-address">-->
<!--                    <i class="fa fa-map-marker-alt" style="color: gray; margin-right: 5px;"></i>-->
<!--                    {{ current_user.address if current_user.address is defined else "No address on file" }}-->
<!--                </p>-->
<!--                <div class="edit-field" id="edit-address" style="display:none;">-->
<!--                    <input type="text" name="address" placeholder="Billing Address" value="{{ current_user.address if current_user.address is defined else '' }}" class="form-control">-->
<!--                </div>-->
<!--            </section>-->

            <!-- Membership Section -->
            <section class="profile-section" id="membership-section">
                <div class="section-header">
                    <h2 class="tds-text--h2">MEMBERSHIP</h2>
                </div>
                <div class="membership-info">
                    <!-- User Roles -->
                    <div class="user-roles">
                        <h3 class="tds-text--h3">Roles:</h3>
                        <div class="role-list">
                            <!-- Show Basic role first if user has it -->
                            {% if 'Basic' in user_roles %}
                                <span class="role-badge role-basic">Basic</span>
                            {% endif %}
                            <!-- Show Pro role if user has it -->
                            {% if 'Pro' in user_roles %}
                                <span class="role-badge role-pro">Pro</span>
                            {% endif %}
                            <!-- Show Admin role if user has it -->
                            {% if 'Admin' in user_roles %}
                                <span class="role-badge role-admin">Admin</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Pro Status (moved below roles) -->
                    {% if pro_end_date %}
                        <div class="pro-status">
                            {% if is_pro %}
                                <p class="tds-text--value pro-member">
                                    <i class="fa fa-crown" style="color: #ffd700; margin-right: 8px;"></i>
                                    Pro Member (valid until {{ pro_end_date.strftime('%Y-%m-%d') }})
                                </p>
                            {% else %}
                                <p class="tds-text--value expired-pro">
                                    <i class="fa fa-clock" style="color: #dc3545; margin-right: 8px;"></i>
                                    Pro Membership expired on {{ pro_end_date.strftime('%Y-%m-%d') }}
                                </p>
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="pro-status">
                            <p class="tds-text--value basic-member">
                                <i class="fa fa-user" style="color: #6c757d; margin-right: 8px;"></i>
                                Basic Member
                            </p>
                        </div>
                    {% endif %}
                </div>
            </section>
        </div>

        <!-- Action Buttons -->
        <div class="actions" style="margin-top:20px; text-align: center;">
            <button type="submit" id="save-button" style="
                    padding: 5px 25px;
                    font-size: 1.1em;
                    background-color: #3498db;
                    color: #fff;
                    border: none;
                    border-radius: 4px;
                    display: none;
                ">
                Save Changes
            </button>

            <div style="margin:20px 0;">
                <a href="https://billing.stripe.com/p/login/28obJgabC3QHeZ2dQQ" style="
                    padding: 5px 25px;
                    font-size: 1.1em;
                    text-decoration: none;
                    color: #fff;
                    background-color: #e67e22;
                    border-radius: 4px;
                    display: inline-block;
                " target="_blank">
                    Manage Your Membership and Billing
                </a>
            </div>

            <div style="display: flex; justify-content: space-evenly; align-items: center; margin-top: 20px;">
                <a href="{{ url_for('custom_change_password') }}">Change Password</a>
                <a href="{{ url_for('public.home') }}">Go to Map</a>
            </div>
        </div>
    </form>
</div>

<script>
    document.querySelectorAll('.edit-link').forEach(function(link) {
        link.addEventListener('click', function(event) {
            event.preventDefault();
            var section = document.getElementById(this.getAttribute('data-section'));
            section.querySelectorAll('.tds-text--value').forEach(function(el) {
                el.style.display = 'none';
            });
            section.querySelectorAll('.edit-field').forEach(function(el) {
                el.style.display = 'block';
            });
            document.getElementById('save-button').style.display = 'inline-block';
            this.style.display = 'none';
        });
    });
</script>
{% endblock %}
