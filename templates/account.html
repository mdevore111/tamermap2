{% extends "base.html" %}

{% block extra_head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/account.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block title %}Account - Tamermap.com{% endblock %}

{% block content %}
<div class="form-container">
    <h1 class="tds-text--h1">Personal Information</h1>
    <p class="subtitle">
        Manage your basic information, contact methods, account details, and membership status.
    </p>
    <form method="post" action="{{ url_for('auth.update_profile') }}">
        {{ form.hidden_tag() if form is defined else "" }}

        <div class="profile-container">
            <!-- Basic Information Section -->
            <section class="profile-section" id="basic-info-section">
                <div class="section-header">
                    <h2 class="tds-text--h2">NAME</h2>
                    <a href="#" class="edit-link" data-section="basic-info-section">Edit</a>
                </div>
                <p class="tds-text--value" id="display-name">
                    {{ current_user.first_name }} {{ current_user.last_name }}
                </p>
                <div class="edit-field" id="edit-name" style="display:none;">
                    <input type="text" name="first_name" placeholder="First Name" value="{{ current_user.first_name }}"
                           class="form-control" style="display:inline-block; width:48%; margin-right:4%;">
                    <input type="text" name="last_name" placeholder="Last Name" value="{{ current_user.last_name }}"
                           class="form-control" style="display:inline-block; width:48%;">
                </div>
            </section>

            <!-- Primary Email Section -->
            <section class="profile-section" id="email-section">
                <div class="section-header">
                    <h2 class="tds-text--h2">PRIMARY EMAIL</h2>
                    <a href="#" class="edit-link" data-section="email-section">Edit</a>
                </div>
                <p class="tds-text--value" id="display-email">
                    <i class="fa fa-envelope" style="color: #007bff; margin-right: 5px;"></i>
                    {{ current_user.email }}
                </p>
                <div class="edit-field" id="edit-email" style="display:none;">
                    <input type="email" name="email" placeholder="Primary Email" value="{{ current_user.email }}" class="form-control">
                </div>
            </section>

<!--            &lt;!&ndash; Primary Phone Number Section (Pro Subscribers Only) &ndash;&gt;-->
<!--            <section class="profile-section" id="phone-section">-->
<!--                <div class="section-header">-->
<!--                    <h2 class="tds-text&#45;&#45;h2">PRIMARY PHONE NUMBER</h2>-->
<!--                    <a href="#" class="edit-link" data-section="phone-section">Edit</a>-->
<!--                </div>-->
<!--                <p class="tds-text&#45;&#45;value" id="display-phone">-->
<!--                    <i class="fa fa-phone" style="color: green; margin-right: 5px;"></i>-->
<!--                    {{ current_user.phone if current_user.phone is defined else "+1 000 000 0000" }}-->
<!--                </p>-->
<!--                <div class="edit-field" id="edit-phone" style="display:none;">-->
<!--                    <input type="text" name="phone" placeholder="Primary Phone Number" value="{{ current_user.phone if current_user.phone is defined else '' }}" class="form-control">-->
<!--                </div>-->
<!--            </section>-->

<!--            &lt;!&ndash; Billing Address Section (Pro Subscribers Only) &ndash;&gt;-->
<!--            <section class="profile-section" id="address-section">-->
<!--                <div class="section-header">-->
<!--                    <h2 class="tds-text&#45;&#45;h2">BILLING ADDRESS</h2>-->
<!--                    <a href="#" class="edit-link" data-section="address-section">Edit</a>-->
<!--                </div>-->
<!--                <p class="tds-text&#45;&#45;value" id="display-address">-->
<!--                    <i class="fa fa-map-marker-alt" style="color: gray; margin-right: 5px;"></i>-->
<!--                    {{ current_user.address if current_user.address is defined else "No address on file" }}-->
<!--                </p>-->
<!--                <div class="edit-field" id="edit-address" style="display:none;">-->
<!--                    <input type="text" name="address" placeholder="Billing Address" value="{{ current_user.address if current_user.address is defined else '' }}" class="form-control">-->
<!--                </div>-->
<!--            </section>-->

            <!-- Membership Section -->
            <section class="profile-section" id="membership-section">
                <div class="section-header">
                    <h2 class="tds-text--h2">MEMBERSHIP</h2>
                </div>
                <p class="tds-text--value" id="display-membership">
                    {% if is_pro %}
                        Pro Member (valid until {{ current_user.pro_end_date.strftime('%Y-%m-%d') if current_user.pro_end_date else "N/A" }})
                    {% else %}
                        Basic Member
                    {% endif %}
                </p>
            </section>
        </div>

        <!-- Action Buttons -->
        <div class="actions" style="margin-top:20px; text-align: center;">
            <button type="submit" id="save-button" style="
                    padding: 5px 25px;
                    font-size: 1.1em;
                    background-color: #3498db;
                    color: #fff;
                    border: none;
                    border-radius: 4px;
                    display: none;
                ">
                Save Changes
            </button>

            <div style="margin:20px 0;">
                <a href="https://billing.stripe.com/p/login/28obJgabC3QHeZ2dQQ" style="
                    padding: 5px 25px;
                    font-size: 1.1em;
                    text-decoration: none;
                    color: #fff;
                    background-color: #e67e22;
                    border-radius: 4px;
                    display: inline-block;
                " target="_blank">
                    Manage Your Membership and Billing
                </a>
            </div>

            <div style="display: flex; justify-content: space-evenly; align-items: center; margin-top: 20px;">
                <a href="{{ url_for('security.change_password') }}">Change Password</a>
                <a href="{{ url_for('public.maps') }}">Go to Map</a>
            </div>
        </div>
    </form>
</div>

<script>
    document.querySelectorAll('.edit-link').forEach(function(link) {
        link.addEventListener('click', function(event) {
            event.preventDefault();
            var section = document.getElementById(this.getAttribute('data-section'));
            section.querySelectorAll('.tds-text--value').forEach(function(el) {
                el.style.display = 'none';
            });
            section.querySelectorAll('.edit-field').forEach(function(el) {
                el.style.display = 'block';
            });
            document.getElementById('save-button').style.display = 'inline-block';
            this.style.display = 'none';
        });
    });
</script>
{% endblock %}
