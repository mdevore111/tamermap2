{# add_location_form.html #}
{% extends "base.html" %}

{% block title %}Add New Location - Submit Pokemon Card Store to TamerMap{% endblock %}

{% block meta_description %}Add a new Pokemon card store, kiosk, or retailer to TamerMap. Help other hunters find locations by submitting store information, hours, and contact details.{% endblock %}

{% block content %}
<div class="page-content">
  <div class="form-container">
    <h1>Add New Location</h1>
    <p class="lead">Help other Pokemon card hunters by adding a new store, kiosk, or retailer to our map.</p>
    <p>Please provide as much information as possible about the location. Our team will review and add it to the map.</p>

    <form method="POST" action="{{ url_for('public.send_message') }}">
      {{ form.hidden_tag() }}

      {# Hidden fields for form configuration #}
      <input type="hidden" name="communication_type" value="location">
      <input type="hidden" name="form_type" value="add_new">
      <input type="hidden" name="is_admin_report" value="true">
      <input type="hidden" name="is_new_location" value="true">
      <input type="hidden" name="subject" value="New Location Submission">
      
      {# Spam prevention fields #}
      {{ form.honeypot(class="honeypot-field") }}
      {{ form.timestamp(value=request.args.get('ts', '')) }}
      {{ form.website(class="honeypot-field") }}
      {{ form.phone(class="honeypot-field") }}
      
      <script>
        // Add timestamp to form for spam prevention
        document.addEventListener('DOMContentLoaded', function() {
          var timestampField = document.querySelector('input[name="timestamp"]');
          if (timestampField) {
            timestampField.value = Date.now();
          }
          
          // Add random delay to prevent instant submissions
          var submitButton = document.querySelector('input[type="submit"]');
          if (submitButton) {
            submitButton.disabled = true;
            setTimeout(function() {
              submitButton.disabled = false;
            }, 2000);
          }
        });
      </script>

      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <label for="name" class="form-label">Your Name</label>
            {{ form.name(class="form-control", placeholder="Enter your name") }}
            {% if form.name.errors %}
              <div class="text-danger">
                {% for error in form.name.errors %}
                  <small>{{ error }}</small>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label for="address" class="form-label">Your Email</label>
            {{ form.address(class="form-control", placeholder="Enter your email address") }}
            {% if form.address.errors %}
              <div class="text-danger">
                {% for error in form.address.errors %}
                  <small>{{ error }}</small>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="mb-3">
        <label for="reported_address" class="form-label">Store Address <span class="text-danger">*</span></label>
        {{ form.reported_address(class="form-control", placeholder="Enter the complete store address") }}
        {% if form.reported_address.errors %}
          <div class="text-danger">
            {% for error in form.reported_address.errors %}
              <small>{{ error }}</small>
            {% endfor %}
          </div>
        {% endif %}
        <div class="form-text">Include street address, city, state, and ZIP code</div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <label for="reported_phone" class="form-label">Phone Number</label>
            {{ form.reported_phone(class="form-control", placeholder="(555) 123-4567") }}
            {% if form.reported_phone.errors %}
              <div class="text-danger">
                {% for error in form.reported_phone.errors %}
                  <small>{{ error }}</small>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label for="reported_website" class="form-label">Website</label>
            {{ form.reported_website(class="form-control", placeholder="https://store-website.com") }}
            {% if form.reported_website.errors %}
              <div class="text-danger">
                {% for error in form.reported_website.errors %}
                  <small>{{ error }}</small>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="mb-3">
        <label for="reported_hours" class="form-label">Store Hours</label>
        {{ form.reported_hours(class="form-control", placeholder="Mon-Fri: 9AM-9PM, Sat: 10AM-8PM, Sun: 11AM-6PM") }}
        {% if form.reported_hours.errors %}
          <div class="text-danger">
            {% for error in form.reported_hours.errors %}
              <small>{{ error }}</small>
            {% endfor %}
          </div>
        {% endif %}
        <div class="form-text">Include operating hours for each day of the week</div>
      </div>

      <div class="mb-3">
        <label for="body" class="form-label">Additional Information <span class="text-danger">*</span></label>
        {{ form.body(class="form-control", rows="5", placeholder="Tell us more about this location: What type of store is it? Do they sell Pokemon cards? Any special features or notes?") }}
        {% if form.body.errors %}
          <div class="text-danger">
            {% for error in form.body.errors %}
              <small>{{ error }}</small>
            {% endfor %}
          </div>
        {% endif %}
        <div class="form-text">Include details about the store type, Pokemon card availability, and any other relevant information</div>
      </div>

      <div class="mb-3">
        <!-- Empty div to match correct location form structure -->
      </div>

      <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <a href="{{ url_for('public.splash') }}" class="btn btn-outline-secondary me-md-2">Cancel</a>
        {{ form.submit(class="btn btn-primary") }}
      </div>
    </form>
  </div>
</div>

<style>
.honeypot-field {
  display: none !important;
  position: absolute;
  left: -9999px;
}
</style>
{% endblock %}
